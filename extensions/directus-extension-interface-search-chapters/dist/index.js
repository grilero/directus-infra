import{defineComponent as e,ref as l,computed as t,resolveComponent as a,openBlock as i,createBlock as n,withCtx as o,createVNode as c,normalizeClass as u,createElementVNode as r,createTextVNode as d,createElementBlock as s,Fragment as p,renderList as v,unref as f,toDisplayString as m}from"vue";import{useApi as y,useStores as _}from"@directus/extensions-sdk";const b={class:"item-text"};var h=e({__name:"interface",props:{disabled:{type:Boolean,default:!1},collection:{type:String,required:!0},field:{type:String,required:!0},value:{type:[String,Number],default:null},placeholder:{type:String,default:"Select an item"},template:{type:String,default:"name"},width:{type:String,required:!0},filter:{type:Object,default:null}},emits:["input"],setup(e,{emit:h}){const g=e,k=h,C=y(),{useCollectionsStore:S,useRelationsStore:w,useFieldsStore:F}=_(),x=S(),$=w(),q=F(),{relatedCollection:D}=function(){const e=t((()=>{var e;return null==(e=$.getRelationsForField(g.collection,g.field))?void 0:e[0]}));return{relatedCollection:t((()=>{var l;return(null==(l=e.value)?void 0:l.related_collection)?x.getCollection(e.value.related_collection):null}))}}();g.template.replace("{{","").replace("}}","");const O=q.getPrimaryKeyFieldForCollection(D.value.collection);let V=!1;const j=l([]),R=l("");async function T(){try{const e=await C.get(`/items/${D.value.collection}`,{params:{limit:-1,filter:g.filter,search:R.value&&R.value!=g.value?R.value:""}});if(j.value=e.data.data,null!=g.value&&""==R.value){const e=await C.get(`/items/${D.value.collection}/${g.value}`);R.value=B(e.data.data)}}catch(e){console.warn(e)}}function B(e){let l=g.template,t="";return Object.keys(e).forEach((a=>{t="{{"+a+"}}",l=l.replace(t,e[a])})),l}function E(){V||setTimeout((()=>{T(),V=!1}),500),V=!0}function I(e){null==e?(R.value=e,k("input",e)):(R.value=B(e),k("input",e[O.field])),T()}return T(),(l,t)=>{const y=a("v-icon"),_=a("v-input"),h=a("v-list-item-content"),g=a("v-list-item-icon"),k=a("v-list-item"),C=a("v-divider"),S=a("v-list"),w=a("v-menu");return i(),n(w,{attached:"",disabled:e.disabled,"close-on-content-click":!0},{activator:o((({active:l,activate:a})=>[c(_,{modelValue:R.value,"onUpdate:modelValue":[t[1]||(t[1]=e=>R.value=e),E],disabled:e.disabled,placeholder:e.placeholder,class:u({"has-value":e.value}),nullable:!1,onFocus:a},{append:o((()=>[null!==e.value?(i(),n(y,{key:0,clickable:"",name:"close",onClick:t[0]||(t[0]=e=>I(null))})):(i(),n(y,{key:1,clickable:"",name:"expand_more",class:u(["open-indicator",{open:l}]),onClick:a},null,8,["class","onClick"]))])),_:2},1032,["modelValue","disabled","placeholder","class","onFocus"])])),default:o((()=>[r("div",{class:u(["content",e.width])},[c(S,{class:"list"},{default:o((()=>[c(k,{disabled:null===e.value,onClick:t[2]||(t[2]=e=>l.$emit("input",null))},{default:o((()=>[c(h,null,{default:o((()=>t[3]||(t[3]=[d("Deselect")]))),_:1}),c(g,null,{default:o((()=>[c(y,{name:"close"})])),_:1})])),_:1},8,["disabled"]),c(C),(i(!0),s(p,null,v(j.value,((l,t)=>(i(),n(k,{key:l[f(O).field]+t,active:e.value===l[f(O).field],disabled:e.disabled,onClick:e=>I(l)},{default:o((()=>[c(h,null,{default:o((()=>[r("span",b,m(B(l)),1)])),_:2},1024)])),_:2},1032,["active","disabled","onClick"])))),128))])),_:1})],2)])),_:1},8,["disabled"])}}}),g={id:"o2m-search-chapters",name:"Search Chapter",type:"interface",description:"Dropdown field that allows the user to search for a chapter",icon:"arrow_drop_down_circle",component:((e,l)=>{const t=e.__vccOpts||e;for(const[e,a]of l)t[e]=a;return t})(h,[["__file","interface.vue"]]),options:null,types:["uuid","string","text","integer","bigInteger"],localTypes:["o2m"],group:"relational",relational:!0,recommendedDisplays:["related-values"]};export{g as default};
